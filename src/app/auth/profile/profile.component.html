<div *ngIf="!!currentUser else loading" class="container">
    <div class="card card-body mb-3">
        <div *ngIf="!editing else editMode" class="wrapper">
            <div class="wrapper">
                <img src='{{currentUser.avatar}}' class="avatar" alt="avatar">
                <h3>{{currentUser.username}}</h3>
            </div>
            <button (click)="editProfileToggle()"  class="btn btn-outline-primary">Edit Profile</button>
        </div>
    </div>

    <h3 class="card-title">My reviews</h3>

    <ng-container *ngIf="!!currentUser.reviews else noReviews">
        <app-review *ngFor="let review of currentUser.reviews" [reviewId]="review" [displayGame]="true"></app-review>
    </ng-container>
</div>

<ng-template #loading>
    <p>Loading...</p>
</ng-template>

<ng-template #noReviews>
    <p>This user has not submitted any reviews yet.</p>
</ng-template>

<ng-template #editMode>
    <form class="edit-profile" [formGroup]="profileForm" (ngSubmit)="updateProfile()">
        <fieldset>
            
            <div class="username">
                <label for="username"></label>
                <input formControlName="username" class="form-control {{showError('username') ?  'is-invalid' : ''}}" type="text" name="username" id="username" placeholder="New name">
                <ng-container *ngIf="showError('username')">
                    <p class="invalid-feedback" *ngIf="validation('username', 'maxLength')">Username is too long!</p>
                </ng-container>
            </div>

            <div class="avatarForm">
                <label for="avatar"></label>
                <input formControlName="avatar" class="form-control {{showError('avatar') ?  'is-invalid' : ''}}" type="text" name="avatar" id="avatar" placeholder="https://www.example.com/your/avatar">
                <ng-container *ngIf="showError('avatar')">
                    <p class="invalid-feedback" *ngIf="validation('avatar', 'url')">Invalid avatar url!</p>
                </ng-container>
            </div>


            <div class="button">
                <button class="btn btn-primary m-3" [disabled]="this.profileForm.invalid">Update</button>
                <button class="btn btn-danger m-3" (click)="editProfileToggle()">Cancel</button>
            </div>
            
        </fieldset>
    </form>
</ng-template>